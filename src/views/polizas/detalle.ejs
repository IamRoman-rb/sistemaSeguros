<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle de la Póliza</title>
</head>
<body>
  <%- include("../partials/header") %>
  <main>
    <header>
      <h1>Detalle de la Póliza #<%= poliza.n_poliza %></h1>
      <nav>
        <a href="/polizas">Volver al listado de polizas</a>
        <% if (poliza.pagos.length == 0) { %>
          <a href="/polizas/editar/<%= poliza.id %>">Editar</a>
        <% } %>
        <% if (poliza.pagos.length < poliza.cuotas) { %>
          <a href="/pagos/pagar/<%= poliza.id %>">Nuevo Pago</a>
        <% } %>
        <% if (!["Empleado"].includes(user.rol)) { %>
          <a href="/polizas/confirmar/<%= poliza.id %>">Eliminar Poliza</a>
        <% } %>
      </nav>
    </header>
    <ul>
      <li>
        <strong>Cliente:</strong>
        <dl>
          <dt>Nombre:</dt>
          <dd><%= cliente.nombre %></dd>
          <dt>CUIT:</dt>
          <dd><%= cliente.cuit %></dd>
          <dt>Telefono:</dt>
          <dd><%= cliente.telefono %></dd>
        </dl>
        <nav>
          <a href="/clientes/detalle/<%= cliente.id %>">Ver Cliente</a>
        </nav>
      </li>

      <li>
        <strong>Poliza:</strong>
        <dl>
          <dt>Número de Poliza:</dt>
          <dd><%= poliza.n_poliza %></dd>
          <dt>Fecha de Emisión:</dt>
          <dd><%= poliza.f_emision %></dd>
          <dt>Inicio Vigencia:</dt>
          <dd><%= poliza.f_ini_vigencia %></dd>
          <dt>Fin Vigencia:</dt>
          <dd><%= poliza.f_fin_vigencia %></dd>
          <dt>Precio de la Poliza:</dt>
          <dd><%= new Intl.NumberFormat("es-AR",{ style: 'currency', currency: 'ARS' }).format(poliza.precio) %></dd>
          <dt>Empresa:</dt>
          <dd><%= poliza.empresa.nombre %></dd>
          <dt>Cobertura:</dt>
          <dd><%= poliza.cobertura.nombre %>: <%= poliza.cobertura.descripcion %></dd>
          <dt>Cuotas:</dt>
          <dd><%= poliza.cuotas %></dd>
          <dt>Cuotas Pagas:</dt>
          <dd><%= poliza.pagos.filter(pago => !pago.desconocido).length %></dd>
        </dl>
      </li>
      <li>
        <strong>Vehiculo:</strong>
        <dl>
          <dt>Marca:</dt>
          <dd><%= poliza.marca.marca %></dd>
          <dt>Modelo:</dt>
          <dd><%= poliza.modelo %></dd>
          <dt>Año:</dt>
          <dd><%= poliza.anio %></dd>
          <dt>Patente:</dt>
          <dd><%= poliza.patente %></dd>
          <dt>N Chasis:</dt>
          <dd><%= poliza.n_chasis %></dd>
          <dt>N Motor:</dt>
          <dd><%= poliza.n_motor %></dd>
          <dt>Combustible:</dt>
          <dd><%= poliza.combustible %></dd>
        </dl>
      </li>
      <li>
        <strong>Pagos:</strong>
        <% if (poliza.pagos.filter(pago => !pago.desconocido).length == 0) { %>
          <p>No hay pagos</p>
        <% } else { %>
          <ul>
            <% poliza.pagos.filter(pago => !pago.desconocido).forEach(pago => { %>
              <li>
                <dl>
                  <dt>Fecha:</dt>
                  <dd><%= pago.fecha %> a las <%= pago.hora %></dd>
                  <dt>Premio:</dt>
                  <dd><%= new Intl.NumberFormat("es-AR",{ style: 'currency', currency: 'ARS' }).format(pago.valor) %></dd>
                  <dt>Observaciones:</dt>
                  <dd><%= pago.observaciones %></dd>
                  <dt>Forma de Pago:</dt>
                  <dd><%= pago.forma_pago %></dd>
                </dl>
                <nav>
                  <a href="/pagos/detalle/<%= pago.id %>">Detalle</a>
                </nav>
              </li>
            <% }) %>
          </ul>
        <% } %>
      </li>
    </ul> 
  </main>
</body>
</html>
